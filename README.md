# cybozu_restore_cabinet
※当スクリプトにより損害等が生じても、当方は一切責任を負いません  
※必ずバックアップデータに対してスクリプトを実行してください  
※あらゆるリスクを想定し、スタンドアロン環境で実行することを推奨します  
※環境の違いにより正常に動作しない可能性がありますが、対応できません  
※二次配布は禁止しますが、カスタムはご自由にどうぞ  
  
# 動作内容  
通常のフォルダと組織（グループ）フォルダを一気に作成し、フォルダに紐づくファイルを順次復元します。  
（組織フォルダはすべての組織分フォルダが作成されますので、不要なフォルダは後から削除してください）  
同じ組織名の組織が複数ある場合や、組織名と同じ通常フォルダがある場合はフォルダがマージされます。  
同じフォルダに同じファイル名のファイルがあった場合は、ファイル名の先頭にIDを付与し、両方復元されます。  
関連付けるフォルダが見つからないファイルは「_救出_n」というフォルダに復元されます。  
掲示板の添付ファイルやそのコメントの添付ファイルが復元されているのを確認していますが、正しいフォルダにないファイルはこちらから探すと見つかるかもしれません。  
ファイルのタイトル部分は復元されません。  
バージョン（世代）履歴と思われるファイルは復元されません。  
復元したファイルと未復元のファイル一覧をcsvファイルに書き出します。  
  
# スクリプトの種類について  
通常版スクリプトはファイルをコピーしながら復元するので、ファイル容量と同じディスク空き容量と時間が必要です。  
元ファイル削除版はファイルをコピーではなく移動するので劇的に速いです。  
ただし、やり直しが発生する場合は再度バックアップが必要です。  
  
# 使い方  
1. サイボウズのインストールされているサーバーのデータバックアップを取る  
サイボウズをメンテナンス状態にし、「cb5」フォルダを丸ごとコピーするか、以下のファイルとフォルダをSSDなどにコピーする。  
・cb5\data\cabinet.odbx  
・cb5\data\office.odbx  
・cb5\file\Cabinet  
参考：https://jp.cybozu.help/of10/ja/admin/spec/dir/data.html  

2. Python環境のある端末でスクリプトを配置・修正する  
「cb5」フォルダがあるフォルダにスクリプトをコピーする。  
必要に応じてスクリプト内の各odbxファイルや「Cabinet」フォルダへのパスを修正する。  
  
3. スクリプトを実行する  
  
# 公開について
現在公開しているのはデータベースの読み込みまでです  
うまく動作すれば公式Xやその他公式SNSで御礼をいただくことなどを条件に完成版を無償配布したいと考えています。  
プライベートのリポジトリに招待するか、MicrosoftのOneDriveで共有するかを検討しています。  
現在X（Twitter）でも需要を調査しているところです。  
気になることがあればディスカッションのコメント欄へどうぞ。  
